{"version":3,"file":"cancelable-promise.cjs.js","sources":["../src/CancelError.ts","../src/PromiseControl.ts","../src/TimeoutError.ts","../src/CancelablePromise.ts"],"sourcesContent":["export class CancelError extends Error {\n  name = 'CancelError';\n\n  constructor() {\n    super();\n    Object.setPrototypeOf(this, CancelError.prototype);\n  }\n}\n","import type CancelablePromise from '.';\n\nexport interface PromiseControlOptions {\n  onStart?: () => void;\n  onStop?: () => void;\n}\n\ntype Key = CancelablePromise | string | number | symbol;\n\nexport class PromiseControl {\n  private _promises: Map<Key, CancelablePromise> = new Map();\n\n  constructor(private options: PromiseControlOptions = {}) {}\n\n  get isLoaded(): boolean {\n    return this._promises.size > 0;\n  }\n\n  remove(promise: Key): void {\n    if (this._promises.has(promise)) {\n      this._promises.delete(promise);\n      this._onStop();\n    }\n  }\n\n  get(promise: Key): CancelablePromise | undefined {\n    return this._promises.get(promise);\n  }\n\n  add<T extends CancelablePromise = CancelablePromise>(\n    promise: T,\n    name?: string | number | symbol,\n  ): CancelablePromise<T> {\n    const key = name ? name : promise;\n    const exist = this._promises.get(key);\n    if (this.options.onStart && !this.isLoaded) {\n      this.options.onStart();\n    }\n    if (exist) {\n      return exist;\n    }\n    this._promises.set(key, promise);\n    promise.finally(() => {\n      this.remove(key);\n    });\n    return promise;\n  }\n\n  abort(): void {\n    if (this.isLoaded) {\n      this._promises.forEach((x) => {\n        if (x.cancel) {\n          x.cancel();\n        }\n      });\n      this._promises.clear();\n      this._onStop();\n    }\n  }\n\n  waitFunc<T>(func: () => any, name = ''): CancelablePromise<T> {\n    name = name || func.name;\n    const exist = this.get(name);\n    if (exist) {\n      return exist;\n    }\n    return this.add(func(), name);\n  }\n\n  WaitForMe(name: string | symbol = ''): MethodDecorator {\n    const get = this.get.bind(this);\n    const add = this.add.bind(this);\n    return function (\n      target: unknown,\n      key: string | symbol,\n      descriptor: PropertyDescriptor,\n    ): PropertyDescriptor {\n      const originalMethod = descriptor.value;\n      name = name || key;\n      descriptor.value = function (...args: any[]) {\n        const exist = get(name);\n        if (exist) {\n          return exist;\n        }\n        const result = add(originalMethod.apply(this, args), name);\n        return result;\n      };\n\n      return descriptor;\n    };\n  }\n\n  /** @deprecated use {@link PromiseControl.WaitForMe } instead */\n  GetOrCreateDecorator(name: string | symbol = ''): MethodDecorator {\n    return this.WaitForMe(name);\n  }\n\n  private _onStop(): void {\n    if (this.options.onStop && !this.isLoaded) {\n      this.options.onStop();\n    }\n  }\n}\n","export class TimeoutError extends Error {\n  name = 'TimeoutError';\n\n  constructor() {\n    super();\n    Object.setPrototypeOf(this, TimeoutError.prototype);\n  }\n}\n","import { CancelError } from './CancelError';\nimport { PromiseControl } from './PromiseControl';\nimport { TimeoutError } from './TimeoutError';\n\nimport type { PromiseControlOptions } from './PromiseControl';\n\ntype Reject = (reason?: any) => void;\ntype Resolve = (value?: any) => void;\nexport type OnCancelFunction = (cancelHandler: () => void) => void;\n\nconst handleCallback = <T = never>(\n  resolve: Resolve,\n  reject: Reject,\n  callback: Resolve,\n  r: T,\n) => {\n  try {\n    resolve(callback(r));\n  } catch (e) {\n    reject(e);\n  }\n};\n\nlet ID = 0;\n\n/**\n * Promise that can be canceled\n *\n * @example\n * Catch `CancelError`\n * ```javascript\n * import CancelablePromise from \"@nextgis/cancelable-promise\";\n *\n * const promise = new CancelablePromise((resolve, reject) => {\n *  setTimeout(() => resolve(), 100);\n * }).catch((er) => {\n *  if (er.name === \"CancelError\") {\n *    // handle cancel error\n *  }\n *  throw er;\n * });\n *\n * promise.cancel();\n * ```\n * @example\n * Handle `onCancel` callback\n * ```javascript\n * import CancelablePromise from \"@nextgis/cancelable-promise\";\n *\n * const promise = new CancelablePromise((resolve, reject, onCancel) => {\n *   const xhr = new XMLHttpRequest();\n *   xhr.open(\"GET\", url, true);\n *   xhr.onload = () => {\n *     resolve(xhr.responseText);\n *   };\n *   xhr.onerror = (er) => {\n *     reject(er);\n *   };\n *\n *   onCancel(() => {\n *     xhr.abort();\n *   });\n *\n *   xhr.send();\n * });\n *\n * promise.cancel();\n * ```\n */\nexport class CancelablePromise<T = any> implements Promise<T> {\n  static CancelError = CancelError;\n  static TimeoutError = TimeoutError;\n  static PromiseControl = PromiseControl;\n\n  // @ts-expect-error Property '[Symbol.toStringTag]' has no initializer and is not definitely assigned in the constructor\n  readonly [Symbol.toStringTag]: string;\n  readonly id = ID++;\n  private _isCanceled = false;\n  private _isPending = true;\n  private _promise?: Promise<T>;\n  private _cancelPromise?: Promise<T>;\n  private _cancelHandlers: (() => void)[] = [];\n  private _setCanceledCallback?: (er?: any) => void;\n  private _parentPromise?: CancelablePromise;\n  private _children: CancelablePromise[] = [];\n\n  constructor(\n    executor: (\n      resolve: (value?: T | PromiseLike<T>) => void,\n      reject: (reason?: any) => void,\n      onCancel: OnCancelFunction,\n    ) => void,\n    timeout?: number,\n  ) {\n    this._cancelPromise = new Promise<any>((resolve_, reject_) => {\n      this._setCanceledCallback = (er) => resolve_(er || new CancelError());\n    });\n    const promises = [\n      this._cancelPromise,\n      new Promise<T>((resolve, reject) => {\n        const onResolve = (value?: T | PromiseLike<T>) => {\n          if (value instanceof CancelablePromise) {\n            this.attach(value);\n          } else {\n            this._isPending = false;\n          }\n          // TODO: fix types, `undefined` not allowed since 19.12.2020\n          resolve(value as T | PromiseLike<T>);\n        };\n\n        const onReject = (error: any) => {\n          this._isPending = false;\n          reject(error);\n        };\n\n        const onCancel: OnCancelFunction = (handler) => {\n          if (!this._isPending) {\n            throw new Error(\n              'The `onCancel` handler was attached after the promise settled.',\n            );\n          }\n\n          this._cancelHandlers.push(handler);\n        };\n\n        return executor(onResolve, onReject, onCancel);\n      }),\n    ];\n    if (timeout) {\n      promises.push(\n        new Promise((resolve, reject) => {\n          setTimeout(() => {\n            if (this._isPending) {\n              try {\n                this.cancel();\n              } finally {\n                reject(new TimeoutError());\n              }\n            }\n          }, timeout);\n        }),\n      );\n    }\n    this._promise = Promise.race(promises);\n  }\n\n  static createControl(opt?: PromiseControlOptions): PromiseControl {\n    return new PromiseControl(opt);\n  }\n\n  static resolve<T>(value: T | PromiseLike<T>): CancelablePromise<T> {\n    return new CancelablePromise((resolve) => resolve(value));\n  }\n\n  static reject<T>(value: T | PromiseLike<T>): CancelablePromise<T> {\n    return new CancelablePromise((resolve, reject) => reject(value));\n  }\n\n  static all<T>(values: (T | PromiseLike<T>)[]): CancelablePromise<T[]> {\n    return new CancelablePromise((resolve, reject) => {\n      Promise.all(values).then(resolve).catch(reject);\n    }).catch((er) => {\n      if (er instanceof this.CancelError) {\n        for (const v of values) {\n          const v_ = v as CancelablePromise;\n          if ('cancel' in v_) {\n            v_.cancel();\n          }\n        }\n      }\n      throw er;\n    });\n  }\n\n  attach(p: CancelablePromise): void {\n    if (this._isCanceled) {\n      p.cancel();\n    } else {\n      this._children.push(p);\n    }\n  }\n\n  then<TResult1 = T, TResult2 = never>(\n    onfulfilled?:\n      | ((value: T) => TResult1 | PromiseLike<TResult1>)\n      | undefined\n      | null,\n    onrejected?:\n      | ((reason: any) => TResult2 | PromiseLike<TResult2>)\n      | undefined\n      | null,\n  ): CancelablePromise<TResult1 | TResult2> {\n    const p = new CancelablePromise((resolve, reject) => {\n      if (this._promise) {\n        const reject_ = (r: any) => {\n          if (onrejected) {\n            handleCallback(resolve, reject, onrejected, r);\n          } else {\n            reject(r);\n          }\n        };\n        this._promise.then((r) => {\n          if (this._isCanceled) {\n            reject_(r);\n          } else {\n            if (onfulfilled) {\n              handleCallback(resolve, reject, onfulfilled, r);\n            } else {\n              resolve(r);\n            }\n          }\n        }, reject_);\n      }\n    });\n    p._parentPromise = this;\n    this._children.push(p);\n    return p as CancelablePromise<TResult1 | TResult2>;\n  }\n\n  catch<TResult = never>(\n    onrejected?:\n      | ((reason: Error) => TResult | PromiseLike<TResult>)\n      | undefined\n      | null,\n  ): CancelablePromise<T | TResult> {\n    if (this._isCanceled && onrejected) {\n      onrejected(new CancelError());\n    }\n    return this.then(undefined, onrejected);\n  }\n\n  finally(onfinally?: (() => void) | undefined | null): Promise<T> {\n    if (this._promise) {\n      return this._promise.finally(onfinally);\n    }\n    if (this._isCanceled) {\n      return Promise.reject(new CancelError());\n    }\n    return Promise.reject<T>(onfinally);\n  }\n\n  cancel(): this {\n    // No reason to run cancel action if promise is already complete\n    if (this._isCanceled || !this._isPending) {\n      return this;\n    }\n    this._isCanceled = true;\n    const parent = this._getTopParent();\n    if (parent) {\n      parent.cancel();\n    }\n\n    if (this._children) {\n      this._children.forEach((x) => x.cancel());\n    }\n\n    if (this._isPending) {\n      if (this._cancelHandlers.length) {\n        try {\n          for (const handler of this._cancelHandlers) {\n            handler();\n          }\n        } catch {\n          // this._setCanceledCallback(error);\n        }\n      }\n      if (this._setCanceledCallback) {\n        this._setCanceledCallback();\n      }\n    }\n    this._destroy();\n\n    return this;\n  }\n\n  private _getTopParent() {\n    let parent = this._parentPromise;\n    let hasParent = !!parent;\n    while (hasParent) {\n      if (parent && parent._parentPromise) {\n        parent = parent._parentPromise;\n        hasParent = !!parent;\n      } else {\n        hasParent = false;\n      }\n    }\n    return parent;\n  }\n\n  private _destroy() {\n    this._setCanceledCallback = undefined;\n    this._cancelPromise = undefined;\n    this._promise = undefined;\n  }\n}\n\nObject.setPrototypeOf(CancelablePromise.prototype, Promise.prototype);\n"],"names":["__publicField"],"mappings":"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"}