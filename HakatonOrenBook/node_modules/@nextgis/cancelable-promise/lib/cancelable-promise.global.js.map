{"version":3,"file":"cancelable-promise.global.js","sources":["../src/CancelError.ts","../src/PromiseControl.ts","../src/TimeoutError.ts","../src/CancelablePromise.ts"],"sourcesContent":["export class CancelError extends Error {\n  name = 'CancelError';\n\n  constructor() {\n    super();\n    Object.setPrototypeOf(this, CancelError.prototype);\n  }\n}\n","import type CancelablePromise from '.';\n\nexport interface PromiseControlOptions {\n  onStart?: () => void;\n  onStop?: () => void;\n}\n\ntype Key = CancelablePromise | string | number | symbol;\n\nexport class PromiseControl {\n  private _promises: Map<Key, CancelablePromise> = new Map();\n\n  constructor(private options: PromiseControlOptions = {}) {}\n\n  get isLoaded(): boolean {\n    return this._promises.size > 0;\n  }\n\n  remove(promise: Key): void {\n    if (this._promises.has(promise)) {\n      this._promises.delete(promise);\n      this._onStop();\n    }\n  }\n\n  get(promise: Key): CancelablePromise | undefined {\n    return this._promises.get(promise);\n  }\n\n  add<T extends CancelablePromise = CancelablePromise>(\n    promise: T,\n    name?: string | number | symbol,\n  ): CancelablePromise<T> {\n    const key = name ? name : promise;\n    const exist = this._promises.get(key);\n    if (this.options.onStart && !this.isLoaded) {\n      this.options.onStart();\n    }\n    if (exist) {\n      return exist;\n    }\n    this._promises.set(key, promise);\n    promise.finally(() => {\n      this.remove(key);\n    });\n    return promise;\n  }\n\n  abort(): void {\n    if (this.isLoaded) {\n      this._promises.forEach((x) => {\n        if (x.cancel) {\n          x.cancel();\n        }\n      });\n      this._promises.clear();\n      this._onStop();\n    }\n  }\n\n  waitFunc<T>(func: () => any, name = ''): CancelablePromise<T> {\n    name = name || func.name;\n    const exist = this.get(name);\n    if (exist) {\n      return exist;\n    }\n    return this.add(func(), name);\n  }\n\n  WaitForMe(name: string | symbol = ''): MethodDecorator {\n    const get = this.get.bind(this);\n    const add = this.add.bind(this);\n    return function (\n      target: unknown,\n      key: string | symbol,\n      descriptor: PropertyDescriptor,\n    ): PropertyDescriptor {\n      const originalMethod = descriptor.value;\n      name = name || key;\n      descriptor.value = function (...args: any[]) {\n        const exist = get(name);\n        if (exist) {\n          return exist;\n        }\n        const result = add(originalMethod.apply(this, args), name);\n        return result;\n      };\n\n      return descriptor;\n    };\n  }\n\n  /** @deprecated use {@link PromiseControl.WaitForMe } instead */\n  GetOrCreateDecorator(name: string | symbol = ''): MethodDecorator {\n    return this.WaitForMe(name);\n  }\n\n  private _onStop(): void {\n    if (this.options.onStop && !this.isLoaded) {\n      this.options.onStop();\n    }\n  }\n}\n","export class TimeoutError extends Error {\n  name = 'TimeoutError';\n\n  constructor() {\n    super();\n    Object.setPrototypeOf(this, TimeoutError.prototype);\n  }\n}\n","import { CancelError } from './CancelError';\nimport { PromiseControl } from './PromiseControl';\nimport { TimeoutError } from './TimeoutError';\n\nimport type { PromiseControlOptions } from './PromiseControl';\n\ntype Reject = (reason?: any) => void;\ntype Resolve = (value?: any) => void;\nexport type OnCancelFunction = (cancelHandler: () => void) => void;\n\nconst handleCallback = <T = never>(\n  resolve: Resolve,\n  reject: Reject,\n  callback: Resolve,\n  r: T,\n) => {\n  try {\n    resolve(callback(r));\n  } catch (e) {\n    reject(e);\n  }\n};\n\nlet ID = 0;\n\n/**\n * Promise that can be canceled\n *\n * @example\n * Catch `CancelError`\n * ```javascript\n * import CancelablePromise from \"@nextgis/cancelable-promise\";\n *\n * const promise = new CancelablePromise((resolve, reject) => {\n *  setTimeout(() => resolve(), 100);\n * }).catch((er) => {\n *  if (er.name === \"CancelError\") {\n *    // handle cancel error\n *  }\n *  throw er;\n * });\n *\n * promise.cancel();\n * ```\n * @example\n * Handle `onCancel` callback\n * ```javascript\n * import CancelablePromise from \"@nextgis/cancelable-promise\";\n *\n * const promise = new CancelablePromise((resolve, reject, onCancel) => {\n *   const xhr = new XMLHttpRequest();\n *   xhr.open(\"GET\", url, true);\n *   xhr.onload = () => {\n *     resolve(xhr.responseText);\n *   };\n *   xhr.onerror = (er) => {\n *     reject(er);\n *   };\n *\n *   onCancel(() => {\n *     xhr.abort();\n *   });\n *\n *   xhr.send();\n * });\n *\n * promise.cancel();\n * ```\n */\nexport class CancelablePromise<T = any> implements Promise<T> {\n  static CancelError = CancelError;\n  static TimeoutError = TimeoutError;\n  static PromiseControl = PromiseControl;\n\n  // @ts-expect-error Property '[Symbol.toStringTag]' has no initializer and is not definitely assigned in the constructor\n  readonly [Symbol.toStringTag]: string;\n  readonly id = ID++;\n  private _isCanceled = false;\n  private _isPending = true;\n  private _promise?: Promise<T>;\n  private _cancelPromise?: Promise<T>;\n  private _cancelHandlers: (() => void)[] = [];\n  private _setCanceledCallback?: (er?: any) => void;\n  private _parentPromise?: CancelablePromise;\n  private _children: CancelablePromise[] = [];\n\n  constructor(\n    executor: (\n      resolve: (value?: T | PromiseLike<T>) => void,\n      reject: (reason?: any) => void,\n      onCancel: OnCancelFunction,\n    ) => void,\n    timeout?: number,\n  ) {\n    this._cancelPromise = new Promise<any>((resolve_, reject_) => {\n      this._setCanceledCallback = (er) => resolve_(er || new CancelError());\n    });\n    const promises = [\n      this._cancelPromise,\n      new Promise<T>((resolve, reject) => {\n        const onResolve = (value?: T | PromiseLike<T>) => {\n          if (value instanceof CancelablePromise) {\n            this.attach(value);\n          } else {\n            this._isPending = false;\n          }\n          // TODO: fix types, `undefined` not allowed since 19.12.2020\n          resolve(value as T | PromiseLike<T>);\n        };\n\n        const onReject = (error: any) => {\n          this._isPending = false;\n          reject(error);\n        };\n\n        const onCancel: OnCancelFunction = (handler) => {\n          if (!this._isPending) {\n            throw new Error(\n              'The `onCancel` handler was attached after the promise settled.',\n            );\n          }\n\n          this._cancelHandlers.push(handler);\n        };\n\n        return executor(onResolve, onReject, onCancel);\n      }),\n    ];\n    if (timeout) {\n      promises.push(\n        new Promise((resolve, reject) => {\n          setTimeout(() => {\n            if (this._isPending) {\n              try {\n                this.cancel();\n              } finally {\n                reject(new TimeoutError());\n              }\n            }\n          }, timeout);\n        }),\n      );\n    }\n    this._promise = Promise.race(promises);\n  }\n\n  static createControl(opt?: PromiseControlOptions): PromiseControl {\n    return new PromiseControl(opt);\n  }\n\n  static resolve<T>(value: T | PromiseLike<T>): CancelablePromise<T> {\n    return new CancelablePromise((resolve) => resolve(value));\n  }\n\n  static reject<T>(value: T | PromiseLike<T>): CancelablePromise<T> {\n    return new CancelablePromise((resolve, reject) => reject(value));\n  }\n\n  static all<T>(values: (T | PromiseLike<T>)[]): CancelablePromise<T[]> {\n    return new CancelablePromise((resolve, reject) => {\n      Promise.all(values).then(resolve).catch(reject);\n    }).catch((er) => {\n      if (er instanceof this.CancelError) {\n        for (const v of values) {\n          const v_ = v as CancelablePromise;\n          if ('cancel' in v_) {\n            v_.cancel();\n          }\n        }\n      }\n      throw er;\n    });\n  }\n\n  attach(p: CancelablePromise): void {\n    if (this._isCanceled) {\n      p.cancel();\n    } else {\n      this._children.push(p);\n    }\n  }\n\n  then<TResult1 = T, TResult2 = never>(\n    onfulfilled?:\n      | ((value: T) => TResult1 | PromiseLike<TResult1>)\n      | undefined\n      | null,\n    onrejected?:\n      | ((reason: any) => TResult2 | PromiseLike<TResult2>)\n      | undefined\n      | null,\n  ): CancelablePromise<TResult1 | TResult2> {\n    const p = new CancelablePromise((resolve, reject) => {\n      if (this._promise) {\n        const reject_ = (r: any) => {\n          if (onrejected) {\n            handleCallback(resolve, reject, onrejected, r);\n          } else {\n            reject(r);\n          }\n        };\n        this._promise.then((r) => {\n          if (this._isCanceled) {\n            reject_(r);\n          } else {\n            if (onfulfilled) {\n              handleCallback(resolve, reject, onfulfilled, r);\n            } else {\n              resolve(r);\n            }\n          }\n        }, reject_);\n      }\n    });\n    p._parentPromise = this;\n    this._children.push(p);\n    return p as CancelablePromise<TResult1 | TResult2>;\n  }\n\n  catch<TResult = never>(\n    onrejected?:\n      | ((reason: Error) => TResult | PromiseLike<TResult>)\n      | undefined\n      | null,\n  ): CancelablePromise<T | TResult> {\n    if (this._isCanceled && onrejected) {\n      onrejected(new CancelError());\n    }\n    return this.then(undefined, onrejected);\n  }\n\n  finally(onfinally?: (() => void) | undefined | null): Promise<T> {\n    if (this._promise) {\n      return this._promise.finally(onfinally);\n    }\n    if (this._isCanceled) {\n      return Promise.reject(new CancelError());\n    }\n    return Promise.reject<T>(onfinally);\n  }\n\n  cancel(): this {\n    // No reason to run cancel action if promise is already complete\n    if (this._isCanceled || !this._isPending) {\n      return this;\n    }\n    this._isCanceled = true;\n    const parent = this._getTopParent();\n    if (parent) {\n      parent.cancel();\n    }\n\n    if (this._children) {\n      this._children.forEach((x) => x.cancel());\n    }\n\n    if (this._isPending) {\n      if (this._cancelHandlers.length) {\n        try {\n          for (const handler of this._cancelHandlers) {\n            handler();\n          }\n        } catch {\n          // this._setCanceledCallback(error);\n        }\n      }\n      if (this._setCanceledCallback) {\n        this._setCanceledCallback();\n      }\n    }\n    this._destroy();\n\n    return this;\n  }\n\n  private _getTopParent() {\n    let parent = this._parentPromise;\n    let hasParent = !!parent;\n    while (hasParent) {\n      if (parent && parent._parentPromise) {\n        parent = parent._parentPromise;\n        hasParent = !!parent;\n      } else {\n        hasParent = false;\n      }\n    }\n    return parent;\n  }\n\n  private _destroy() {\n    this._setCanceledCallback = undefined;\n    this._cancelPromise = undefined;\n    this._promise = undefined;\n  }\n}\n\nObject.setPrototypeOf(CancelablePromise.prototype, Promise.prototype);\n"],"names":["__publicField"],"mappings":"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"}